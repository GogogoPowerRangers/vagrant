<!-- Licensed Materials - Property of IBM 5725-K40 (C) --> 
<!-- Copyright IBM Corporation 2013. All rights reserved. -->
<!-- US Government Users Restricted Rights - Use, duplication --> 
<!-- or disclosure restricted by GSA ADP Schedule Contract with IBM Corp. -->
<!-- VERSION changed to 6.3 -->

<?xml version="1.0" encoding="UTF-8"?>
<oslc_template xmlns:tmsoslc="http://localhost.com/tmsoslc"
               xmlns:crtv="http://open-services.net/ns/crtv#"
               xmlns:im="http://tivoli-OSLC-prototypes/ns/im#">
  <!-- This section is for query assembly mapping -->
  <tmsoslc:product>KYN</tmsoslc:product>
  <tmsoslc:when>@ checkVersionRange ${VERSION} MIN '06.30.00' *EQ 1</tmsoslc:when>
  <tmsoslc:interval minutes="30"/>

  <tmsoslc:queries>
    <!-- This query is joined to the AppHealth column values -->

    <tmsoslc:query name="Q_kyn_WebAppHealth" discovery="y">
	  <tmsoslc:where>"SYSTEM.PARMA('NODELIST','${THRUNODE}',32) AND ORIGINNODE = '${MSYSN}' AND APPL_NAME *NE '[Summary]' ORDER BY AVG_RT DESC"</tmsoslc:where>
      <tmsoslc:tablename name="KYNAPP">
        <tmsoslc:columnname>APPL_NAME</tmsoslc:columnname>
        <tmsoslc:columnname>WAR_NAME</tmsoslc:columnname>
        <tmsoslc:columnname>NUM_ERRORS</tmsoslc:columnname>
        <tmsoslc:columnname>AVG_RT</tmsoslc:columnname>
      </tmsoslc:tablename>
    </tmsoslc:query>

    <tmsoslc:query name="Q_kyn_ApplicationServerStatus" discovery="y">
      <tmsoslc:where>"SYSTEM.PARMA('NODELIST','${THRUNODE}',32) AND ORIGINNODE = '${THRUNODE}' AND SSNNAM = '${MSN1}' ORDER BY  STATUS DESC"</tmsoslc:where>
      <tmsoslc:tablename name="KYNAPSST">
        <tmsoslc:columnname>WAS_CNAM</tmsoslc:columnname>
        <tmsoslc:columnname>WAS_NNAM</tmsoslc:columnname>
        <tmsoslc:columnname>SERVER_NAM</tmsoslc:columnname>
        <tmsoslc:columnname>WAS_RNAM</tmsoslc:columnname>
        <tmsoslc:columnname>STATUS</tmsoslc:columnname>
        <tmsoslc:columnname>TYPE</tmsoslc:columnname>
        <tmsoslc:columnname>SRVGRP_NAM</tmsoslc:columnname>
        <tmsoslc:columnname>SRVGRP_TYP</tmsoslc:columnname>
		<tmsoslc:columnname>IPADDR</tmsoslc:columnname>
        <tmsoslc:columnname>APPBSPORT</tmsoslc:columnname>
      </tmsoslc:tablename>
    </tmsoslc:query>

    <tmsoslc:query name="Q_kyn_ApplicationHealthStatus" discovery="y">
      <tmsoslc:attach>"${Q_kyn_WebAppHealth.APPL_NAME} *EQ ${APP_NAME}"</tmsoslc:attach>
      <tmsoslc:where>"SYSTEM.PARMA('NODELIST','${THRUNODE}',32) AND ORIGINNODE = '${MSYSN}' AND APP_NAME *NE 'SCA' ORDER BY APP_STAT DESC"</tmsoslc:where>
      <tmsoslc:tablename name="KYNAPHLTH">
        <tmsoslc:columnname>APP_NAME</tmsoslc:columnname>
        <tmsoslc:columnname>APP_STAT</tmsoslc:columnname>
        <tmsoslc:columnname>APP_HLTH</tmsoslc:columnname>
        <tmsoslc:columnname>WEBT_HLTH</tmsoslc:columnname>
        <tmsoslc:columnname>EJB_HLTH</tmsoslc:columnname>
        <tmsoslc:columnname>EIS_HLTH</tmsoslc:columnname>
        <tmsoslc:columnname>RQRSP_LVL</tmsoslc:columnname>
        <tmsoslc:columnname>RQERR_LVL</tmsoslc:columnname>
        <tmsoslc:columnname>WEBC_LVL</tmsoslc:columnname>
        <tmsoslc:columnname>PORTC_LVL</tmsoslc:columnname>
        <tmsoslc:columnname>EJBC_LVL</tmsoslc:columnname>
        <tmsoslc:columnname>CUSTRQ_LVL</tmsoslc:columnname>
        <tmsoslc:columnname>JDBC_LVL</tmsoslc:columnname>
        <tmsoslc:columnname>JCA_LVL</tmsoslc:columnname>
        <tmsoslc:columnname>JMS_LVL</tmsoslc:columnname>
        <tmsoslc:columnname>JNDI_LVL</tmsoslc:columnname>
        <tmsoslc:columnname>SCA_LVL</tmsoslc:columnname>
        <tmsoslc:columnname from="WAR_NAME">APP_MODULENAME</tmsoslc:columnname>
        <tmsoslc:columnname from="NUM_ERRORS">NUM_ERRORS</tmsoslc:columnname>
        <tmsoslc:columnname from="AVG_RT">AVG_RT</tmsoslc:columnname>
      </tmsoslc:tablename>
    </tmsoslc:query>

	<tmsoslc:query name="Q_kyn_ApplicationHealthStatus_Metric" discovery="n">
      <tmsoslc:attach>"${Q_kyn_WebAppHealth.APPL_NAME} *EQ ${APP_NAME}"</tmsoslc:attach>
      <tmsoslc:where>"SYSTEM.PARMA('NODELIST','${THRUNODE}',32) AND ORIGINNODE = '${MSYSN}' AND APP_NAME = '${crtv:name}'"</tmsoslc:where>
      <tmsoslc:tablename name="KYNAPHLTH">
        <tmsoslc:columnname>APP_NAME</tmsoslc:columnname>
        <tmsoslc:columnname>APP_STAT</tmsoslc:columnname>
        <tmsoslc:columnname>APP_HLTH</tmsoslc:columnname>
        <tmsoslc:columnname>WEBT_HLTH</tmsoslc:columnname>
        <tmsoslc:columnname>EJB_HLTH</tmsoslc:columnname>
        <tmsoslc:columnname>EIS_HLTH</tmsoslc:columnname>
        <tmsoslc:columnname>RQRSP_LVL</tmsoslc:columnname>
        <tmsoslc:columnname>RQERR_LVL</tmsoslc:columnname>
        <tmsoslc:columnname>WEBC_LVL</tmsoslc:columnname>
        <tmsoslc:columnname>PORTC_LVL</tmsoslc:columnname>
        <tmsoslc:columnname>EJBC_LVL</tmsoslc:columnname>
        <tmsoslc:columnname>CUSTRQ_LVL</tmsoslc:columnname>
        <tmsoslc:columnname>JDBC_LVL</tmsoslc:columnname>
        <tmsoslc:columnname>JCA_LVL</tmsoslc:columnname>
        <tmsoslc:columnname>JMS_LVL</tmsoslc:columnname>
        <tmsoslc:columnname>JNDI_LVL</tmsoslc:columnname>
        <tmsoslc:columnname>SCA_LVL</tmsoslc:columnname>
        <tmsoslc:columnname from="WAR_NAME">APP_MODULENAME</tmsoslc:columnname>
        <tmsoslc:columnname from="NUM_ERRORS">NUM_ERRORS</tmsoslc:columnname>
        <tmsoslc:columnname from="AVG_RT">AVG_RT</tmsoslc:columnname>
      </tmsoslc:tablename>
    </tmsoslc:query>

    <!-- Garbage Collection data -->
    <tmsoslc:query name="Q_kyn_GarbageCollectionAnalysis" discovery="n">
      <tmsoslc:where>"SYSTEM.PARMA('NODELIST','${THRUNODE}',32) AND ORIGINNODE = '${MSYSN}'"</tmsoslc:where>
      <tmsoslc:tablename name="KYNGCACT">
        <tmsoslc:columnname>HEAP_USPCT</tmsoslc:columnname>
        <tmsoslc:columnname>GC_RATE</tmsoslc:columnname>
        <tmsoslc:columnname>HEAP_MAX</tmsoslc:columnname>
        <tmsoslc:columnname>NUMB_FREE</tmsoslc:columnname>
        <tmsoslc:columnname>NUM_RUN</tmsoslc:columnname>
		<tmsoslc:columnname>HEAP_USPCT</tmsoslc:columnname>	
      </tmsoslc:tablename>
    </tmsoslc:query>

    <!-- Thread pool data -->
    <tmsoslc:query name="Q_kyn_ThreadPoolData" discovery="n">
      <tmsoslc:where>"SYSTEM.PARMA('NODELIST','${THRUNODE}',32) AND ORIGINNODE = '${MSYSN}' AND THRDP_NAME *NE '[Summary]' ORDER BY PCT_TIMMAX DESC, MAX_SIZE  DESC"</tmsoslc:where>
      <tmsoslc:tablename name="KYNTHRDP">
        <tmsoslc:columnname>THRDP_NAME</tmsoslc:columnname>
        <tmsoslc:columnname>PCT_TIMMAX</tmsoslc:columnname>
        <tmsoslc:columnname>MAX_SIZE</tmsoslc:columnname>
        <tmsoslc:columnname>POOL_SIZE</tmsoslc:columnname>
      </tmsoslc:tablename>
    </tmsoslc:query>

    <!-- JCA Connection Pool data -->
    <tmsoslc:query name="Q_kyn_J2CConnectionPoolData" discovery="n">
      <tmsoslc:where>"SYSTEM.PARMA('NODELIST','${THRUNODE}',32) AND ORIGINNODE = '${MSYSN}' AND CFACT_NAME *NE '[Summary]' ORDER BY PERC_MAXED DESC"</tmsoslc:where>
      <tmsoslc:tablename name="KYNJ2C">
        <tmsoslc:columnname>CFACT_NAME</tmsoslc:columnname>
        <tmsoslc:columnname>PERC_MAXED</tmsoslc:columnname>
        <tmsoslc:columnname>AVG_WAIT</tmsoslc:columnname>
      </tmsoslc:tablename>
    </tmsoslc:query>

    <!-- Database Connection Pool data -->
    <tmsoslc:query name="Q_kyn_DBConnectionPoolData" discovery="n">
      <tmsoslc:where>"SYSTEM.PARMA('NODELIST','${THRUNODE}',32) AND ORIGINNODE = '${MSYSN}' AND NAME *NE '[Summary]' ORDER BY PCT_MAX DESC"</tmsoslc:where>
      <tmsoslc:tablename name="KYNDBCONP">
        <tmsoslc:columnname>NAME</tmsoslc:columnname>
        <tmsoslc:columnname>PCT_MAX</tmsoslc:columnname>
        <tmsoslc:columnname>AVG_WAIT</tmsoslc:columnname>
      </tmsoslc:tablename>
    </tmsoslc:query>

    <!-- JMS Connection Pool data -->
    <tmsoslc:query name="Q_kyn_JMSConnectionPoolData" discovery="n">
      <tmsoslc:where>"SYSTEM.PARMA('NODELIST','${THRUNODE}',32) AND ORIGINNODE = '${MSYSN}' AND QMGR_NAME *NE '[Summary]' ORDER BY AVG_GTIME DESC"</tmsoslc:where>
      <tmsoslc:tablename name="KYNJMSSUM">
        <tmsoslc:columnname>QMGR_NAME</tmsoslc:columnname>
        <tmsoslc:columnname>QUEUE_NAME</tmsoslc:columnname>
        <tmsoslc:columnname>NUM_GET</tmsoslc:columnname>
        <tmsoslc:columnname>AVG_GTIME</tmsoslc:columnname>
        <tmsoslc:columnname>NUM_PUT</tmsoslc:columnname>
        <tmsoslc:columnname>AVG_PTIME</tmsoslc:columnname>
        <tmsoslc:columnname>NUM_BROWSE</tmsoslc:columnname>
        <tmsoslc:columnname>AVG_BTIME</tmsoslc:columnname>
        <tmsoslc:columnname>NUM_PUB</tmsoslc:columnname>
        <tmsoslc:columnname>AVG_PUTIME</tmsoslc:columnname>
      </tmsoslc:tablename>
    </tmsoslc:query>

    <tmsoslc:query name="Q_kyn_RequestData" discovery="n">
      <tmsoslc:where>"SYSTEM.PARMA('NODELIST','${THRUNODE}',32) AND ORIGINNODE = '${MSYSN}' AND APP_NAME *NE '[Summary]' ORDER BY C10 DESC"</tmsoslc:where>
      <tmsoslc:tablename name="KYNREQUEST">
        <tmsoslc:columnname>APP_NAME</tmsoslc:columnname>
        <tmsoslc:columnname>REQ_TYPE</tmsoslc:columnname>
        <tmsoslc:columnname>REQ_NAME</tmsoslc:columnname>
        <tmsoslc:columnname>REQ_DETAIL</tmsoslc:columnname>
        <!-- Average Response -->
        <tmsoslc:columnname>C10</tmsoslc:columnname>
        <!-- SQL Query Time -->
        <tmsoslc:columnname>C28</tmsoslc:columnname>
        <!-- SQL Update Time -->
        <tmsoslc:columnname>C31</tmsoslc:columnname>
        <!-- SQL Execute Time Time -->
        <tmsoslc:columnname>C68</tmsoslc:columnname>
        <!-- JNDI Time -->
        <tmsoslc:columnname>C34</tmsoslc:columnname>
        <!-- JMS Time -->
        <tmsoslc:columnname>C37</tmsoslc:columnname>
        <!-- Application Time -->
        <tmsoslc:columnname>C49</tmsoslc:columnname>
        <!-- JCA Time -->
        <tmsoslc:columnname>C59</tmsoslc:columnname>
        <!-- Portal Processing Time -->
        <tmsoslc:columnname>C63</tmsoslc:columnname>
        <!-- Servlet Time Time -->
        <tmsoslc:columnname>TMSSERVLET</tmsoslc:columnname>
        <!-- EJB Time -->
        <tmsoslc:columnname>TMSEJB</tmsoslc:columnname>
        <!-- Request Completion Percent -->
        <tmsoslc:columnname>COMPL_PCT</tmsoslc:columnname>
        <!-- Completion Level -->
        <tmsoslc:columnname>COMPL_LVL</tmsoslc:columnname>
        <!-- Request Bad Threshold -->
        <tmsoslc:columnname>REQ_BTRSH</tmsoslc:columnname>
        <!-- Request health -->
        <tmsoslc:columnname>REQ_DTYPE</tmsoslc:columnname>
        <!-- Client Tier Bad Delay Time -->
        <tmsoslc:columnname>WEBT_DBAD</tmsoslc:columnname>
        <!-- Backend Tier Health -->
        <tmsoslc:columnname>EIST_DTYPE</tmsoslc:columnname>
        <!-- Backend Tier Bad Delay Time Time -->
        <tmsoslc:columnname>EIST_DBAD</tmsoslc:columnname>
        <!-- SCA Time -->
        <tmsoslc:columnname>C73</tmsoslc:columnname>
        <!-- Client Tier Health -->
        <tmsoslc:columnname>WEBT_DTYPE</tmsoslc:columnname>
        <!-- Application Tier Health -->
        <tmsoslc:columnname>BUST_DTYPE</tmsoslc:columnname>
        <!-- Application Tier Bad Delay Time -->
        <tmsoslc:columnname>BUST_DBAD</tmsoslc:columnname>
      </tmsoslc:tablename>
    </tmsoslc:query>

  
    <tmsoslc:query name="Q_kyn_PortalPageSummary" discovery="n" when="@ KYN_getAffinity ${PRODAFF} *EQ 1">
      <tmsoslc:where>"SYSTEM.PARMA('NODELIST','${THRUNODE}',32) AND ORIGINNODE = '${MSYSN}' AND NAME *NE '[Summary]' ORDER BY AVG_RESP DESC"</tmsoslc:where>
      <tmsoslc:tablename name="KYNWPPAGE">
        <tmsoslc:columnname>NAME</tmsoslc:columnname>
        <tmsoslc:columnname>AVG_RESP</tmsoslc:columnname>
        <tmsoslc:columnname>NUM_REQ</tmsoslc:columnname>
        <tmsoslc:columnname>TTIME_RESP</tmsoslc:columnname>
      </tmsoslc:tablename>
    </tmsoslc:query>

    <tmsoslc:query name="Q_kyn_PortalSummary" discovery="n" when="@ KYN_getAffinity ${PRODAFF} *EQ 1">
      <tmsoslc:where>"SYSTEM.PARMA('NODELIST','${THRUNODE}',32) AND ORIGINNODE = '${MSYSN}'"</tmsoslc:where>
      <tmsoslc:tablename name="KYNWPTALS">
        <tmsoslc:columnname>AVG_PPAGE</tmsoslc:columnname>
      </tmsoslc:tablename>
    </tmsoslc:query>

    <!-- Process Server & ESB Server Summary Metrics data  -->
    <tmsoslc:query name="Q_kyn_ServiceCompElem" discovery="n" when="@ KYN_getAffinity ${PRODAFF} *EQ 2">
      <tmsoslc:where>"SYSTEM.PARMA('NODELIST','${THRUNODE}',32) AND ORIGINNODE = '${MSYSN}' AND C_NAME *NE '[Summary]' ORDER BY AVG_RESP DESC"</tmsoslc:where>
      <tmsoslc:tablename name="KYNSVCOMEL">
        <tmsoslc:columnname>COMPONENT</tmsoslc:columnname>
        <tmsoslc:columnname>C_NAME</tmsoslc:columnname>
        <tmsoslc:columnname>ELEMENT</tmsoslc:columnname>
        <tmsoslc:columnname>E_NAME</tmsoslc:columnname>
        <tmsoslc:columnname>F_COUNT</tmsoslc:columnname>
        <tmsoslc:columnname>SUC_COUNT</tmsoslc:columnname>
        <tmsoslc:columnname>AVG_RESP</tmsoslc:columnname>
        <tmsoslc:columnname>ERR_RATE</tmsoslc:columnname>
        <tmsoslc:columnname>REQ_RATE</tmsoslc:columnname>
      </tmsoslc:tablename>
    </tmsoslc:query>
  </tmsoslc:queries>

  <tmsoslc:ResourceDefinition type="IPAddress">
    <im:list>
      <im:name name="R_kyn_ServerIP">
        <id name="crtv:contextAddressSpace rdf:resource" value="@ KYN_FormatIPAddress 2 ${IPADDR}" />
        <id name="crtv:address" exclude="0.0.0.0" value="@ KYN_FormatIPAddress 1 ${IPADDR}" />
        <namingGroupList name="IP_address">
          <namingGroup name="IP_address_group">
            <namingMember>crtv:contextAddressSpace</namingMember>
            <namingMember>crtv:address</namingMember>
          </namingGroup>
        </namingGroupList>
      </im:name>
    </im:list>
  </tmsoslc:ResourceDefinition>

  <tmsoslc:ResourceDefinition type="ServerAccessPoint">
    <im:list>
      <im:name name="R_kyn_ServerAccessPoint">

        <id name="crtv:portNumber" value="@ KYN_GetBootstrapPort ${Q_kyn_ApplicationServerStatus.APPBSPORT}" />
        <id name="crtv:ipAddress rdf:resource">
          <value>
            <resourceType>IPAddress</resourceType>
            <resourceName>R_kyn_ServerIP</resourceName>
            <scope>this</scope>
          </value>
        </id>
        <namingGroupList name="ServerAccessPoint_gl">
          <namingGroup name="ServerAccessPoint_group">
            <namingMember>crtv:portNumber</namingMember>
            <namingMember>crtv:ipAddress</namingMember>
          </namingGroup>
        </namingGroupList>
      </im:name>
    </im:list>
  </tmsoslc:ResourceDefinition>

  <tmsoslc:ResourceDefinition type="SoftwareServer">
    <im:list>
      <im:name name="R_kyn_AppServer">
	    <id name="crtv:manufacturer" value="IBM"/>
        <id name="crtv:name" value="${Q_kyn_ApplicationServerStatus.WAS_CNAM}:${Q_kyn_ApplicationServerStatus.WAS_NNAM}:${Q_kyn_ApplicationServerStatus.SERVER_NAM}" />
        <id name="rdf:type rdf:resource" value="http://open-services.net/ns/crtv#WebSphereServer" />
        <id name="crtv:instancePath" value="@ KYN_FormatInstancePath ${Q_kyn_ApplicationServerStatus.WAS_CNAM} ${Q_kyn_ApplicationServerStatus.WAS_NNAM} ${Q_kyn_ApplicationServerStatus.SERVER_NAM}  ${Q_kyn_ApplicationServerStatus.WAS_RNAM}" />
        <id name="crtv:runsOn rdf:resource">
          <value>
            <resourceType>ComputerSystem</resourceType>
            <match from="IPADDRESSRAW" to="IPADDRESSRAW" />
          </value>
        </id>
        <id name="crtv:serverAccessPoint rdf:resource">
          <value>
            <resourceType>ServerAccessPoint</resourceType>
            <resourceName>R_kyn_ServerAccessPoint</resourceName>
            <scope>this</scope>
          </value>
        </id>
        <namingGroupList name="SoftwareServer_gl">
          <namingGroup name="SoftwareServer_group1">
            <namingMember>crtv:name</namingMember>
            <namingMember>crtv:instancePath</namingMember>
            <namingMember>crtv:runsOn</namingMember>
          </namingGroup>
          <namingGroup name="SoftwareServer_group2">
            <namingMember>crtv:name</namingMember>
            <namingMember>crtv:serverAccessPoint</namingMember>
          </namingGroup>
          <namingGroup name="SoftwareServer_group3">
            <namingMember>crtv:name</namingMember>
            <namingMember>crtv:runsOn</namingMember>
          </namingGroup>
        </namingGroupList>
        <metrics>ServerHealth</metrics>
      </im:name>
    </im:list>
  </tmsoslc:ResourceDefinition>

  <tmsoslc:ResourceDefinition type="SoftwareModule">
    <im:list>
      <im:name name="R_kyn_SoftwareModule">
        <id name="crtv:name" value="${Q_kyn_ApplicationHealthStatus.APP_NAME}" />
        <id name="crtv:fileName" value="${Q_kyn_ApplicationHealthStatus.APP_MODULENAME}" />
        <id name="rdf:type rdf:resource" value="http://open-services.net/ns/crtv#J2EEApplication" />
        <id name="crtv:deployedTo rdf:resource">
          <value>
            <resourceType>SoftwareServer</resourceType>
            <resourceName>R_kyn_AppServer</resourceName>
            <scope>this</scope>
          </value>
        </id>
        <namingGroupList name="SoftwareModule_gl">
          <namingGroup name="SoftwareModule_group">
            <namingMember>crtv:name</namingMember>
            <namingMember>crtv:fileName</namingMember>
            <namingMember>crtv:deployedTo</namingMember>
          </namingGroup>
        </namingGroupList>
        <identity name="SoftwareModuleIdentity">
          <attributeGroup>KYNAPP</attributeGroup>
          <primaryKey keyNumber="1" attributeName="APPL_NAME" attributeValue="${Q_kyn_WebAppHealth.APPL_NAME}" />
          <primaryKey keyNumber="2" attributeName="WAR_NAME" attributeValue="${Q_kyn_WebAppHealth.WAR_NAME}" />
        </identity> 
        <metrics>AppHealth</metrics>
      </im:name>
    </im:list>
  </tmsoslc:ResourceDefinition>

  <metrics class="ServerHealth">
    <record type="SoftwareServer">
      <metric name="ems:observes">
        <pattern type="none" />
        <reference type="ems:Measure" about="memoryaftergc" name="memory-after-garbage-collection" />
        <widget name="bar" order="1" width="200px" height="325px" title="Memory available after garbage collection" 
         bundle-key="memoryaftergc_title" bundle-name="YNBundle" />
      </metric>

      <!-- Possible memory fragmentation GC rate (count per min) -->
      <metric name="ems:observes">
        <pattern type="none" />
        <reference type="ems:Measure" about="gcrate" name="garbage-collection-rate" />
        <widget name="bar" order="2" width="200px" height="325px" title="Garbage collection rate" bundle-key="gcrate_title" 
         bundle-name="YNBundle" />
      </metric>

      <!-- Top 5 Thread Pool Exhaustion includes JMS Pool (MessageListenerThreadPool) -->
      <metric name="itm:topThreadPoolsInUse">
        <pattern type="sequence" name="threadPoolList-seq" limit="5" />
        <reference type="http://www.w3.org/2000/01/rdf-schema#Container" about="threadPool-${Q_kyn_ThreadPoolData.THRDP_NAME}"  name="threadPool" />
        <widget name="bar" order="3" width="200px" height="325px" title="Thread pools: Top 5 pools in use" bundle-key="tp_maxed_title" bundle-name="YNBundle" />
      </metric>

      <!-- Top 5 JCA Pool Exhaustion -->
      <metric name="itm:topJ2CConnectionPoolsInUse">
        <pattern type="sequence" name="jcaPoolList-seq" limit="5" />
        <reference type="http://www.w3.org/2000/01/rdf-schema#Container" about="jcaPool-${Q_kyn_J2CConnectionPoolData.CFACT_NAME}"  name="jcaPool" />
        <widget name="bar" order="4" width="200px" height="325px" title="JCA pools: Top 5 pools in use" bundle-key="jca_maxed_title" bundle-name="YNBundle" />
      </metric>

      <!-- Top 5 DB Pool Exhaustion -->
      <metric name="itm:topDBConnectionPoolsInUse">
        <pattern type="sequence" name="dbPoolList-seq" limit="5" />
        <reference type="http://www.w3.org/2000/01/rdf-schema#Container" about="dbPool-${Q_kyn_DBConnectionPoolData.NAME}"  name="dbPool" />
          <widget name="bar" order="5" width="200px" height="325px" title="Database pools: Top 5 pools in use" bundle-key="db_maxed_title" bundle-name="YNBundle" />
      </metric>

      <!-- JMS is included Threadpool -->
      <!-- Portal specific Metrics -->
      <!-- How are my portal pages doing? -->

      <metric name="ems:observes" when="@ KYN_getAffinity ${PRODAFF} *EQ 1">
        <pattern type="none" />
        <reference type="ems:Measure" about="avgresptime" name="portal-average-response-time" />
        <widget name="bar" order="6" width="200px" height="325px" 
        title="Average portal page response time" bundle-key="portalresptime_title" 
        bundle-name="YNBundle" />
      </metric>

      <!-- What are the slowest portal pages? -->

      <metric name="itm:topSlowestPortalPages" when="@ KYN_getAffinity ${PRODAFF} *EQ 1">
        <pattern type="sequence" name="portalPgList-seq" limit="5" />
        <reference type="http://www.w3.org/2000/01/rdf-schema#Resource" about="portalPage-${Q_kyn_PortalPageSummary.NAME}"  name="portalPage" />
        <widget name="bar" order="7" width="200px" height="325px" title="Portal Pages: Top 5 slowest pages" bundle-key="portal_pg_rt" bundle-name="YNBundle" />
      </metric>

      <!-- Process Server metrics -->
      <!-- How many overall bad requests across service components? -->
      <!-- SCA, Business rules, map, mediation, business state machine, selector --> 
      <!-- Top 5 slowest service component elements -->

      <metric name="itm:topSlowestServiceComponents" when="@ KYN_getAffinity ${PRODAFF} *EQ 2">
        <pattern type="sequence" name="serviceCompList-seq" limit="5" />
        
        <reference type="http://www.w3.org/2000/01/rdf-schema#Resource" about="serviceCompoent-${Q_kyn_ServiceCompElem.C_NAME}:${Q_kyn_ServiceCompElem.ELEMENT}"  
        name="servCompElement" />
        <widget name="bar" order="6" width="200px" height="325px" title="Service Components: Top 5 slowest component elements" bundle-key="ser_comp_rt" bundle-name="YNBundle" />
      </metric>
    </record>


    <reference name="memory-after-garbage-collection">
      <id name="dcterms:title" value="Percentage free memory after garbage collection" 
       bundle-key="memoryaftergc-tky" bundle-name="YNBundle" />
      <id name="ems:numericValue" datatype="http://www.w3.org/2001/XMLSchema#double" 
       value="@ KYN_DisplayPercentage ${Q_kyn_GarbageCollectionAnalysis.HEAP_USPCT}" 
       displayValue="@ KYN_DisplayPercentage ${Q_kyn_GarbageCollectionAnalysis.HEAP_USPCT} display"
       axis="x" axis-type="number"
       axis-range="0-100"  />
      <id name="ems:unitOfMeasure rdf:resource" value="http://dbpedia.org/resource/Percentage" />
      <id name="ems:metric rdf:resource" 
       value="http://open-services.net/ns/perfmon#MemoryAvailableAfterGarbageCollection" />
    </reference>

    <reference name="garbage-collection-rate">
      <id name="dcterms:title" value="Garbage collection rate" 
       bundle-key="gcrate-tky" bundle-name="YNBundle" />
      <id name="ems:numericValue" datatype="http://www.w3.org/2001/XMLSchema#double" 
       value="${Q_kyn_GarbageCollectionAnalysis.GC_RATE}" displayValue="${Q_kyn_GarbageCollectionAnalysis.GC_RATE}" 
        axis="x"
       axis-type="number" axis-range="0-100" />
      <id name="ems:unitOfMeasure rdf:resource" value="http://open-services.net/ns/perfmon#PerMinute" />
      
      <id name="ems:metric rdf:resource" value="http://open-services.net/ns/perfmon#GarbageCollectionRequest" />
    </reference>

    <!-- This is the definition for the ResourcePool resource that represents a Threadpool.  -->

    <reference name="threadPool" pmr="y">
      <sub-reference property-name="ems:observes" reference-type="ems:Measure" reference-value="threadPoolMetric-${Q_kyn_ThreadPoolData.THRDP_NAME}" reference-name="threadPoolMetric" />
      <id name="crtv:name" value="${Q_kyn_ThreadPoolData.THRDP_NAME}" displayValue="${Q_kyn_ThreadPoolData.THRDP_NAME}" column-name="Thread pool"   exclude="Not_Available,[Summary],Not_Available%,[Summary]%" orderBy="2" axis="y" axis-type="string" column-bundle-key="threadPool-title" column-bundle-name="YNBundle" />
      
	  <id name="rdf:type rdf:resource" value="http://open-services.net/ns/crtv#ThreadPool" />
      <id name="crtv:dependsOn rdf:resource" value="${resourceDefinitionInstance}"/>
    </reference> 

    <reference name="threadPoolMetric">
      <id name="dcterms:title" value="Thread pool utilization" 
       bundle-key="tp_util_metric" bundle-name="YNBundle" />
       <id name="ems:numericValue" datatype="http://www.w3.org/2001/XMLSchema#double" 
        value="@ KYN_DisplayPercentage ${Q_kyn_ThreadPoolData.PCT_TIMMAX}" displayValue="@ KYN_DisplayPercentage ${Q_kyn_ThreadPoolData.PCT_TIMMAX} display"
        exclude="Not_Available,[Summary],Not_Available%,[Summary]%" orderBy="1"
        axis="x" axis-type="number" axis-range="0-100" column-name="Time exhausted" column-bundle-key="time_exhaus_ky" column-bundle-name="YNBundle" />
      <id name="ems:unitOfMeasure rdf:resource" value="http://dbpedia.org/resource/Percentage" />
      <id name="ems:metric rdf:resource"
        value="http://open-services.net/ns/perfmon#TimeThreadPoolExhausted" />
    </reference>

    <reference name="jcaPool" pmr="y">
      <sub-reference property-name="ems:observes" reference-type="ems:Measure" reference-value="jcaPoolMetric-${Q_kyn_J2CConnectionPoolData.CFACT_NAME}" reference-name="jcaPoolMetric" />
      <id name="crtv:name" value="${Q_kyn_J2CConnectionPoolData.CFACT_NAME}" displayValue="${Q_kyn_J2CConnectionPoolData.CFACT_NAME}" column-name="Java connector pool" exclude="Not_Available,[Summary],Not_Available%,[Summary]%" orderBy="2" axis="y" axis-type="string" column-bundle-key="jcaPool-title" column-bundle-name="YNBundle" />
	  
      <id name="rdf:type rdf:resource" value="http://open-services.net/ns/crtv#J2CConnectorPool" />
      <id name="crtv:dependsOn rdf:resource" value="${resourceDefinitionInstance}"/>
    </reference> 

    <reference name="jcaPoolMetric">
      <id name="dcterms:title" value="Java connector pool utilization" bundle-key="jca_util_metric" 
       bundle-name="YNBundle" />
      <id name="ems:numericValue" datatype="http://www.w3.org/2001/XMLSchema#double" 
       value="@ KYN_DisplayPercentage ${Q_kyn_J2CConnectionPoolData.PERC_MAXED}" 
       displayValue="@ KYN_DisplayPercentage ${Q_kyn_J2CConnectionPoolData.PERC_MAXED} display" 
       exclude="Not_Available,[Summary],Not_Available%,[Summary]%" orderBy="1" 
       axis="x" axis-type="number" axis-range="0-100" column-name="Time exhausted" 
       column-bundle-key="time_exhaus_ky" column-bundle-name="YNBundle" />
      <id name="ems:unitOfMeasure rdf:resource" value="http://dbpedia.org/resource/Percentage" />
      <id name="ems:metric rdf:resource" 
       value="http://open-services.net/ns/perfmon#TimeJCAThreadPoolExhausted" />
    </reference>

    <reference name="dbPool" pmr="y">
      <sub-reference property-name="ems:observes" reference-type="ems:Measure" reference-value="dbPoolMetric-${Q_kyn_DBConnectionPoolData.NAME}" reference-name="dbPoolMetric" />
      <id name="crtv:name" value="${Q_kyn_DBConnectionPoolData.NAME}" displayValue="${Q_kyn_DBConnectionPoolData.NAME}" column-name="Database pool"  exclude="Not_Available,[Summary],Not_Available%,[Summary]%" orderBy="2" axis="y" axis-type="string" column-bundle-key="dbPool-title" column-bundle-name="YNBundle" />
	  
 	  <id name="rdf:type rdf:resource" value="http://open-services.net/ns/crtv#DatabaseConnectionPool" />
      <id name="crtv:dependsOn rdf:resource" value="${resourceDefinitionInstance}"/>
    </reference> 

    <reference name="dbPoolMetric">
      <id name="dcterms:title" value="Database pool utilization" bundle-key="db_util_metric" 
       bundle-name="YNBundle" />
      <id name="ems:numericValue" datatype="http://www.w3.org/2001/XMLSchema#double" 
       value="@ KYN_DisplayPercentage ${Q_kyn_DBConnectionPoolData.PCT_MAX}" 
       displayValue="@ KYN_DisplayPercentage ${Q_kyn_DBConnectionPoolData.PCT_MAX} display" 
       exclude="Not_Available,[Summary],Not_Available%,[Summary]%" orderBy="1"
       axis="x" axis-type="number" axis-range="0-100" column-name="Time exhausted" 
       column-bundle-key="time_exhaus_ky" column-bundle-name="YNBundle" /> 
      <id name="ems:unitOfMeasure rdf:resource" value="http://dbpedia.org/resource/Percentage" />
      <id name="ems:metric rdf:resource" 
       value="http://open-services.net/ns/perfmon#TimeDatabaseThreadPoolExhausted" />
    </reference>

    <reference name="portal-average-response-time">
      <id name="dcterms:title" value="Average response time for portal pages" 
       bundle-key="poravgrt-tky" bundle-name="YNBundle" />
      <id name="ems:numericValue" datatype="http://www.w3.org/2001/XMLSchema#double" 
       value="${Q_kyn_PortalSummary.AVG_PPAGE}" displayValue="${Q_kyn_PortalSummary.AVG_PPAGE}" 
	   exclude="Not_Available,[Summary]" axis="x" 
       axis-type="number" />
      <id name="ems:unitOfMeasure rdf:resource" value="http://qudt.org/vocab/unit#SecondTime" />
      
      <id name="ems:metric rdf:resource" value="http://open-services.net/ns/perfmon#ResponseTime" />
    </reference>

    <reference name="portalPage" pmr="y">
      <sub-reference property-name="ems:observes" reference-type="ems:Measure" reference-value="portalPageMetric-${Q_kyn_PortalPageSummary.NAME}" reference-name="portalPgRTMetric" />
	  
	  <id name="crtv:name" value="${Q_kyn_PortalPageSummary.NAME}" displayValue="${Q_kyn_PortalPageSummary.NAME}" column-name="Portal Page" orderBy="2" exclude="Not_Available,[Summary],Not_Available%,[Summary]%" axis="y" axis-type="string" column-bundle-key="portalpgrt-title" column-bundle-name="YNBundle" />
  
	  
      <id name="crtv:dependsOn rdf:resource" value="${resourceDefinitionInstance}"/>
    </reference> 

    <reference name="portalPgRTMetric">
      <id name="dcterms:title" value="Average response time" bundle-key="por_rt_metric" 
       bundle-name="YNBundle" />
      <id name="ems:numericValue" datatype="http://www.w3.org/2001/XMLSchema#double" 
       value="${Q_kyn_PortalPageSummary.AVG_RESP}" 
       displayValue="${Q_kyn_PortalPageSummary.AVG_RESP}" 
       exclude="Not_Available,[Summary],Not_Available%,[Summary]%" orderBy="1" 
       axis="x" axis-type="number" column-name="Average response time"
       column-bundle-key="avg_rt_ky" column-bundle-name="YNBundle" />
      <id name="ems:unitOfMeasure rdf:resource" value="http://qudt.org/vocab/unit#SecondTime" />
      <id name="ems:metric rdf:resource" value="http://open-services.net/ns/perfmon#ResponseTime" />
    </reference>

    <!-- Service Comp references -->
    <reference name="servCompElement" pmr="y">
      <sub-reference property-name="ems:observes" reference-type="ems:Measure" reference-value="serCompMetric-${Q_kyn_ServiceCompElem.C_NAME}:${Q_kyn_ServiceCompElem.ELEMENT}" reference-name="serCompRTMetric" />
      <id name="crtv:name" value="${Q_kyn_ServiceCompElem.C_NAME}:${Q_kyn_ServiceCompElem.ELEMENT}" displayValue="${Q_kyn_ServiceCompElem.C_NAME}:${Q_kyn_ServiceCompElem.ELEMENT}" column-name="Service Component Element" orderBy="2" exclude="Not_Available,[Summary],Not_Available%,[Summary]%" axis="y" axis-type="string" column-bundle-key="sercomprt-title" column-bundle-name="YNBundle" />
	  
      
      <id name="crtv:dependsOn rdf:resource" value="${resourceDefinitionInstance}"/>
    </reference> 

    <reference name="serCompRTMetric">
      <id name="dcterms:title" value="Average response time" bundle-key="sercomp_rt_metric" 
       bundle-name="YNBundle" />
      <id name="ems:numericValue" datatype="http://www.w3.org/2001/XMLSchema#double" 
      value="${Q_kyn_ServiceCompElem.AVG_RESP}" 
      displayValue="${Q_kyn_ServiceCompElem.AVG_RESP}" 
      exclude="Not_Available,[Summary],Not_Available%,[Summary]%" orderBy="1" 
      axis="x" axis-type="number" column-name="Average response time" 
      column-bundle-key="sercompavg_rt_ky" column-bundle-name="YNBundle" />
      <id name="ems:unitOfMeasure rdf:resource" value="http://qudt.org/vocab/unit#SecondTime" />
      <id name="ems:metric rdf:resource" 
       value="http://open-services.net/ns/perfmon#ResponseTime" />
    </reference>
  </metrics>

  <metrics class="AppHealth">
    <record type="SoftwareModule">

      <!-- Application Health: Is my AppHealth Good or bad -->
      <metric name="itm:applicationStatus">
		
        <pattern type="sequence" name="applicationStatus-seq" limit="30" />
        
        <reference type="crtv:ServiceInstance" 
         about="enterpriseApp-${Q_kyn_ApplicationHealthStatus_Metric.APP_NAME}" name="applicationStatus" />
        <widget name="simple-table" order="1" width="200px" height="325px" 
         title="Application Health" bundle-key="app_health_title" bundle-name="YNBundle" />
      </metric>
    </record>

    <reference name="applicationStatus" pmr="y">
      <sub-reference property-name="ems:observes" reference-type="ems:Measure" 
                     reference-value="enterpriseAppRTMetric-${Q_kyn_ApplicationHealthStatus_Metric.APP_NAME}" 
                     reference-name="enterpriseAppRTMetric" />

	  <id name="rdf:type rdf:resource" value="http://open-services.net/ns/crtv#Application" />
	  <id name="crtv:parentServiceInstance rdf:resource" value="http://open-services.net/ns/crtv#NULL" />
	 
      <id name="crtv:name" value="${Q_kyn_ApplicationHealthStatus_Metric.APP_NAME}" 
                                      displayValue="${Q_kyn_ApplicationHealthStatus_Metric.APP_NAME}" 
                                      column="1" column-name="Application" column-bundle-key="appl-name-column-title" 
                                      column-bundle-name="YNBundle" 
                                      orderBy="1" />
      <id name="pm:availabilityStatus rdf:resource" 
                                      value="@ KYN_AppStatus ${Q_kyn_ApplicationHealthStatus_Metric.APP_STAT}" useurl="y" 
                                      displayValue="@ KYN_AppStatus ${Q_kyn_ApplicationHealthStatus_Metric.APP_STAT} display" 
                                      bundle-key="@ KYN_AppStatus ${Q_kyn_ApplicationHealthStatus_Metric.APP_STAT} bundlekey"
                                      bundle-name="YNBundle" 
                                      column="2" column-name="Status" column-bundle-key="app_status_title"                     
                                      column-bundle-name="YNBundle" />
      <id name="itm:applicationHealth  rdf:resource" 
                                     value="@ KYN_AppHealth ${Q_kyn_ApplicationHealthStatus_Metric.APP_HLTH}" useurl="y" 
                                     displayValue="@ KYN_AppHealth ${Q_kyn_ApplicationHealthStatus_Metric.APP_HLTH} display" 
                                     bundle-key="@ KYN_AppHealth ${Q_kyn_ApplicationHealthStatus_Metric.APP_HLTH} bundlekey"
                                     bundle-name="YNBundle" 
                                     column="3" column-name="Health" column-bundle-key="app_health_title" 
                                     column-bundle-name="YNBundle" />
    </reference>

    <reference name="enterpriseAppRTMetric">
      <id name="dcterms:title" value="Average response time" bundle-key="app_rt_metric" bundle-name="YNBundle" />
      <id name="ems:numericValue" datatype="http://www.w3.org/2001/XMLSchema#double"
          value="${Q_kyn_ApplicationHealthStatus_Metric.AVG_RT}"
          displayValue="${Q_kyn_ApplicationHealthStatus_Metric.AVG_RT}"
          exclude="Not_Available,[Summary],Not_Available%,[Summary]%" 
          column="4" column-name="Average response time"
          column-bundle-key="avg_rt_ky" column-bundle-name="YNBundle" />
      <id name="ems:unitOfMeasure rdf:resource" value="http://qudt.org/vocab/unit#SecondTime" />
      <id name="ems:metric rdf:resource" value="http://open-services.net/ns/perfmon#ResponseTime" />
    </reference>
  </metrics>

  <method library="kynutil.lib" name="KYN_isProcessSerOrESBAffinity" />
  <method library="kynutil.lib" name="KYN_isPortalAffinity" />
  <method library="kynutil.lib" name="KYN_getAffinity" />
  <method library="kynutil.lib" name="KYN_CalculatePercentage" />
  <method library="kynutil.lib" name="KYN_DisplayPercentage" />
  <method library="kynutil.lib" name="KYN_AppStatus" />
  <method library="kynutil.lib" name="KYN_AppHealth" />
  <method library="kynutil.lib" name="KYN_FormatIPAddress" />
  <method library="kynutil.lib" name="KYN_GetBootstrapPort" />
  <method library="kynutil.lib" name="KYN_FormatInstancePath" />
  
</oslc_template>
