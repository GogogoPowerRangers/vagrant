<?xml version="1.0" encoding="UTF-8"?>
<!-- Licensed Materials - Property of IBM 5724-V09 (C) -->
<!-- Copyright IBM Corporation 2013. All rights reserved. -->
<!-- US Government Users Restricted Rights - Use, duplication -->
<!-- or disclosure restricted by GSA ADP Schedule Contract with IBM Corp. -->
<oslc_template xmlns:tmsoslc="http://localhost.com/tmsoslc" xmlns:crtv="http://open-services.net/ns/crtv#" xmlns:im="http://tivoli-OSLC-prototypes/ns/im#">
  <tmsoslc:product>KUD</tmsoslc:product>
  <tmsoslc:when>@ checkVersionRange ${VERSION} MIN '06.22.00' *EQ 1</tmsoslc:when>
  <tmsoslc:interval minutes="60"/>
  <tmsoslc:queries>
    <tmsoslc:query name="SYSINFO" discovery="y">
      <tmsoslc:where>
        "SYSTEM.PARMA('NODELIST','${MSYSN}',32) AND ORIGINNODE = '${MSYSN}'"
      </tmsoslc:where>
      <tmsoslc:tablename name="KUDSYSINFO" application="KUD00">
        <tmsoslc:columnname>ORIGINNODE</tmsoslc:columnname>
        <tmsoslc:columnname>INAME</tmsoslc:columnname>
        <tmsoslc:columnname>DB2STAT</tmsoslc:columnname>
        <tmsoslc:columnname>BUSDP</tmsoslc:columnname>
        <tmsoslc:columnname>CEUSDP</tmsoslc:columnname>
        <tmsoslc:columnname>REMCIN</tmsoslc:columnname>
        <tmsoslc:columnname>LCLCON</tmsoslc:columnname>
        <tmsoslc:columnname>CLCLDB</tmsoslc:columnname>
      </tmsoslc:tablename>
    </tmsoslc:query>
    <tmsoslc:query name="IPADDRS" discovery="y">
      <tmsoslc:where>
        "SYSTEM.PARMA('NODELIST','${MSYSN}',32) AND ORIGINNODE = '${MSYSN}'"
    </tmsoslc:where>
      <tmsoslc:tablename name="KUDIPADDR" application="KUD00">
        <tmsoslc:columnname>IPADDR</tmsoslc:columnname>
        <tmsoslc:columnname>IPTYPE</tmsoslc:columnname>
        <tmsoslc:columnname>PORT</tmsoslc:columnname>
      </tmsoslc:tablename>
    </tmsoslc:query>
    <tmsoslc:query name="DB00INFO_DISCOVERY" discovery="y">
      <tmsoslc:where>
        "SYSTEM.PARMA('NODELIST','${MSYSN}',32) AND ORIGINNODE = '${MSYSN}' ORDER BY DBNM"
      </tmsoslc:where>
      <tmsoslc:tablename name="KUDDBASE00" application="KUD00">
        <tmsoslc:columnname>DBNM</tmsoslc:columnname>
        <tmsoslc:columnname>INAME</tmsoslc:columnname>
      </tmsoslc:tablename>
    </tmsoslc:query>
    <tmsoslc:query name="DB00INFO" discovery="n">
      <tmsoslc:where>
        "DBNM = '${crtv:name}' AND SYSTEM.PARMA('NODELIST','${MSYSN}',32) AND ORIGINNODE = '${MSYSN}' ORDER BY DBNM"
      </tmsoslc:where>
      <tmsoslc:tablename name="KUDDBASE00" application="KUD00">
        <tmsoslc:columnname>DBNM</tmsoslc:columnname>
        <tmsoslc:columnname>INAME</tmsoslc:columnname>
        <tmsoslc:columnname>PLHR</tmsoslc:columnname>
        <tmsoslc:columnname>STMFP</tmsoslc:columnname>
        <tmsoslc:columnname>SOFP</tmsoslc:columnname>
      </tmsoslc:tablename>
    </tmsoslc:query>
    <tmsoslc:query name="DB01INFO" discovery="n">
      <tmsoslc:where>
        "DBNM = '${crtv:name}' AND SYSTEM.PARMA('NODELIST','${MSYSN}',32) AND ORIGINNODE = '${MSYSN}' ORDER BY DBNM"
      </tmsoslc:where>
      <tmsoslc:tablename name="KUDDBASE01" application="KUD00">
        <tmsoslc:columnname>DBNM</tmsoslc:columnname>
        <tmsoslc:columnname>LKLUP</tmsoslc:columnname>
      </tmsoslc:tablename>
    </tmsoslc:query>
    <tmsoslc:query name="KUDDBLOG" discovery="n">
      <tmsoslc:where>
        "DBNM = '${crtv:name}' AND SYSTEM.PARMA('NODELIST','${MSYSN}',32) AND ORIGINNODE = '${MSYSN}' ORDER BY DBNM"
      </tmsoslc:where>
      <tmsoslc:tablename name="KUDLOG" application="KUD00">
        <tmsoslc:columnname>DBNM</tmsoslc:columnname>
        <tmsoslc:columnname>TOTLUPCT</tmsoslc:columnname>
      </tmsoslc:tablename>
    </tmsoslc:query>
  </tmsoslc:queries>
  <!-- Resource: IPAddress definition -->
  <tmsoslc:ResourceDefinition type="IPAddress">
    <im:list>
      <im:name name="KUD_Server_IP">
        <id name="crtv:address" exclude="0.0.0.0" value="@ formatOSDPIPAddress ${IPADDRS.IPADDR}"/>
        <id name="crtv:contextAddressSpace rdf:resource" value="@ formatOSDPContextAddressSpace ${IPADDRS.IPADDR}"/>
        <namingGroupList name="KUD_IP_address_gl">
          <namingGroup name="KUD_IP_address_group">
            <namingMember>crtv:contextAddressSpace</namingMember>
            <namingMember>crtv:address</namingMember>
          </namingGroup>
        </namingGroupList>
      </im:name>
    </im:list>
  </tmsoslc:ResourceDefinition>
  <tmsoslc:ResourceDefinition type="ServerAccessPoint">
    <im:list>
      <im:name name="KUD_server_access">
        <id name="crtv:portNumber" value="${IPADDRS.PORT}"/>
        <id name="crtv:ipAddress rdf:resource">
          <value>
            <resourceType>IPAddress</resourceType>
            <resourceName>KUD_Server_IP</resourceName>
            <scope>this</scope>
          </value>
        </id>
        <namingGroupList name="KUD_Server_access_point_gl">
          <namingGroup name="KUD_Server_access_point_group">
            <namingMember>crtv:ipAddress</namingMember>
            <namingMember>crtv:portNumber</namingMember>
          </namingGroup>
        </namingGroupList>
      </im:name>
    </im:list>
  </tmsoslc:ResourceDefinition>
  <tmsoslc:ResourceDefinition type="SoftwareServer">
    <im:list>
      <im:name name="KUD_software_server">
        <id name="crtv:name" value="${SYSINFO.INAME}"/>
        <id name="crtv:serverAccessPoint rdf:resource">
          <value>
            <resourceType>ServerAccessPoint</resourceType>
            <resourceName>KUD_server_access</resourceName>
            <scope>this</scope>
          </value>
        </id>
        <id name="crtv:runsOn rdf:resource">
          <value>
            <resourceType>ComputerSystem</resourceType>
            <match from="IPADDRESSRAW" to="IPADDRESSRAW"/>
          </value>
        </id>
        <id name="rdf:type rdf:resource" value="http://open-services.net/ns/crtv#DB2Instance"/>
        <id name="crtv:manufacturer" value="IBM"/>
        <namingGroupList name="KUD_Software_server_gl">
          <namingGroup name="KUD_Software_server_group1">
            <namingMember>crtv:name</namingMember>
            <namingMember>crtv:runsOn</namingMember>
          </namingGroup>
          <namingGroup name="Software_server_group2">
            <namingMember>crtv:name</namingMember>
            <namingMember>crtv:serverAccessPoint</namingMember>
          </namingGroup>
        </namingGroupList>
        <metrics>KUD_Server_Health</metrics>
      </im:name>
    </im:list>
  </tmsoslc:ResourceDefinition>
  <tmsoslc:ResourceDefinition type="Database">
    <im:list>
      <im:name name="DBINFOR">
        <id name="crtv:name" value="${DB00INFO_DISCOVERY.DBNM}"/>
        <id name="crtv:dbInstance rdf:resource">
          <value>
            <resourceType>SoftwareServer</resourceType>
            <resourceName>KUD_software_server</resourceName>
            <scope>this</scope>
          </value>
        </id>
        <namingGroupList name="KUD_DataBase_server_gl">
          <namingGroup name="KUD_DataBase_server_group">
            <namingMember>crtv:name</namingMember>
            <namingMember>crtv:dbInstance</namingMember>
          </namingGroup>
        </namingGroupList>
        <identity name="DatabaseIdentity">
          <attributeGroup>KUDDBASE00</attributeGroup>
          <primaryKey keyNumber="1" attributeName="DBNM" attributeValue="${DB00INFO_DISCOVERY.DBNM}"/>
        </identity>
        <metrics>KUD_DataBase_Health</metrics>
      </im:name>
    </im:list>
  </tmsoslc:ResourceDefinition>
  <metrics class="KUD_Server_Health">
    <record type="SoftwareServer">
      <!-- Instance status -->
      <metric name="pm:availabilityStatus">
        <id name="pm:availabilityStatus rdf:resource" value="@ KUD_InstanceStatus ${SYSINFO.DB2STAT}" useurl="y" displayValue="@ KUD_InstanceStatus ${SYSINFO.DB2STAT} display" bundle-key="@ KUD_InstanceStatus ${SYSINFO.DB2STAT} bundlekey" bundle-name="UDBundle"/>
        <pattern type="none"/>
        <widget name="text" order="1" title="Instance status" bundle-key="instance_status_title" bundle-name="UDBundle"/>
      </metric>
      <!-- Buffer used -->
      <metric name="ems:observes">
        <pattern type="none"/>
        <reference type="ems:Measure" about="bufferutil" name="buffer-util-metric"/>
        <widget name="bar" order="2" width="200px" height="325px" title="Buffer utilization" bundle-key="buffer_util_title" bundle-name="UDBundle"/>
      </metric>
      <!-- Connection entries used -->
      <metric name="ems:observes">
        <pattern type="none"/>
        <reference type="ems:Measure" about="connentries" name="connection-entries-used-metric"/>
        <widget name="bar" order="3" width="200px" height="325px" title="Connection entry utilization" bundle-key="conn_entries_used_title" bundle-name="UDBundle"/>
      </metric>
      <!-- Remote connections -->
      <metric name="ems:observes">
        <pattern type="none"/>
        <reference type="ems:Measure" about="remoteconn" name="remote-connections-metric"/>
        <widget name="bar" order="4" width="200px" height="325px" title="Remote connections" bundle-key="remote_connections_title" bundle-name="UDBundle"/>
      </metric>
      <metric name="ems:observes">
        <pattern type="none"/>
        <reference type="ems:Measure" about="localconn" name="local-connections-metric"/>
        <widget name="bar" order="5" width="200px" height="325px" title="Local connections" bundle-key="local_connections_title" bundle-name="UDBundle"/>
      </metric>
      <metric name="ems:observes">
        <pattern type="none"/>
        <reference type="ems:Measure" about="databaseconn" name="database-connections-metric"/>
        <widget name="bar" order="6" width="200px" height="325px" title="Database connections" bundle-key="database_connections_title" bundle-name="UDBundle"/>
      </metric>
    </record>
    <!-- Buffer utilization EMS Measure resource  -->
    <reference name="buffer-util-metric">
      <id name="dcterms:title" value="Utilization of Fast Communication Manager buffers" bundle-key="bufferutil-metric-title" bundle-name="UDBundle"/>
      <id name="ems:numericValue" datatype="http://www.w3.org/2001/XMLSchema#double" value="@ KUD_DisplayPercentage ${SYSINFO.BUSDP}" displayValue="@ KUD_DisplayPercentage ${SYSINFO.BUSDP} display" axis="x" axis-type="number" axis-range="0-100"/>
      <id name="ems:unitOfMeasure rdf:resource" value="http://dbpedia.org/resource/Percentage"/>
      <id name="ems:metric rdf:resource" value="http://jazz.net/ns/ism/perfmon/itm#BufferUsed"/>
    </reference>
    <!-- Connection entries EMS Measure resource  -->
    <reference name="connection-entries-used-metric">
      <id name="dcterms:title" value="Utilization of Fast Communication Manager connection entries" bundle-key="conn-entries-metric-title" bundle-name="UDBundle"/>
      <id name="ems:numericValue" datatype="http://www.w3.org/2001/XMLSchema#double" value="@ KUD_DisplayPercentage ${SYSINFO.CEUSDP}" displayValue="@ KUD_DisplayPercentage ${SYSINFO.CEUSDP} display" axis="x" axis-type="number" axis-range="0-100"/>
      <id name="ems:unitOfMeasure rdf:resource" value="http://dbpedia.org/resource/Percentage"/>
      <id name="ems:metric rdf:resource" value="http://jazz.net/ns/ism/perfmon/itm#ConnectionEntriesUsed"/>
    </reference>
    <!-- Remote connections EMS Measure resource  -->
    <reference name="remote-connections-metric">
      <id name="dcterms:title" value="Number of remote connections" bundle-key="remote-conn-metric-title" bundle-name="UDBundle"/>
      <id name="ems:numericValue" datatype="http://www.w3.org/2001/XMLSchema#double" value="${SYSINFO.REMCIN}" displayValue="${SYSINFO.REMCIN}" axis="x" axis-type="number"/>
      <id name="ems:unitOfMeasure rdf:resource" value="http://dbpedia.org/resource/Count_data"/>
      <id name="ems:metric rdf:resource" value="http://open-services.net/ns/perfmon#RemoteInboundConnections"/>
    </reference>
    <reference name="local-connections-metric">
      <id name="dcterms:title" value="Number of local connections" bundle-key="local-conn-metric-title" bundle-name="UDBundle"/>
      <id name="ems:numericValue" datatype="http://www.w3.org/2001/XMLSchema#double" value="${SYSINFO.LCLCON}" displayValue="${SYSINFO.LCLCON}" axis="x" axis-type="number"/>
      <id name="ems:unitOfMeasure rdf:resource" value="http://dbpedia.org/resource/Count_data"/>
      <id name="ems:metric rdf:resource" value="http://open-services.net/ns/perfmon#LocalInboundConnections"/>
    </reference>
    <reference name="database-connections-metric">
      <id name="dcterms:title" value="Number of database connections" bundle-key="database-conn-metric-title" bundle-name="UDBundle"/>
      <id name="ems:numericValue" datatype="http://www.w3.org/2001/XMLSchema#double" value="${SYSINFO.CLCLDB}" displayValue="${SYSINFO.CLCLDB}" axis="x" axis-type="number"/>
      <id name="ems:unitOfMeasure rdf:resource" value="http://dbpedia.org/resource/Count_data"/>
      <id name="ems:metric rdf:resource" value="http://open-services.net/ns/perfmon#HostedDatabases"/>
    </reference>
  </metrics>
  <metrics class="KUD_DataBase_Health">
    <record type="Database">
      <!-- Buffer pool hit ratio -->
      <metric name="ems:observes">
        <pattern type="none"/>
        <reference type="ems:Measure" about="bphitratio" name="bp-pool-hit-ratio-metric"/>
        <widget name="bar" order="1" width="200px" height="325px" title="Buffer pool hit ratio" bundle-key="bp_hit_ratio_title" bundle-name="UDBundle"/>
      </metric>
      <!-- Failed SQL statements -->
      <metric name="ems:observes">
        <pattern type="none"/>
        <reference type="ems:Measure" about="sqlstmtfailures" name="sql-stmts-failures-metric"/>
        <widget name="bar" order="2" width="200px" height="325px" title="SQL statement failures" bundle-key="sql_stmts_fail_title" bundle-name="UDBundle"/>
      </metric>
      <metric name="ems:observes">
        <pattern type="none"/>
        <reference type="ems:Measure" about="locklistinusepct" name="lock-list-inuse-metric"/>
        <widget name="bar" order="3" width="200px" height="325px" title="Lock list utilization" bundle-key="locklist_util_title" bundle-name="UDBundle"/>
      </metric>
      <metric name="ems:observes">
        <pattern type="none"/>
        <reference type="ems:Measure" about="sortoverflow" name="sort-overflow-metric"/>
        <widget name="bar" order="4" width="200px" height="325px" title="Sort Overflows" bundle-key="sortoverflow_util_title" bundle-name="UDBundle"/>
      </metric>
      <metric name="ems:observes">
        <pattern type="none"/>
        <reference type="ems:Measure" about="logutilization" name="log-utilization-metric"/>
        <widget name="bar" order="5" width="200px" height="325px" title="Log Utilization Percentage" bundle-key="logutilization_util_title" bundle-name="UDBundle"/>
      </metric>
    </record>
    <reference name="bp-pool-hit-ratio-metric">
      <id name="dcterms:title" value="Buffer pool hit ratio" bundle-key="bufferused-metric-title" bundle-name="UDBundle"/>
      <id name="ems:numericValue" datatype="http://www.w3.org/2001/XMLSchema#double" value="@ KUD_DisplayPercentage ${DB00INFO.PLHR}" displayValue="@ KUD_DisplayPercentage ${DB00INFO.PLHR} display" axis="x" axis-type="number" axis-range="0-100"/>
      <id name="ems:unitOfMeasure rdf:resource" value="http://dbpedia.org/resource/Percentage"/>
      <id name="ems:metric rdf:resource" value="http://open-services.net/ns/perfmon#BufferPoolHits"/>
    </reference>
    <reference name="sql-stmts-failures-metric">
      <id name="dcterms:title" value="Percentage of failed SQL statements" bundle-key="sqlstmts-metric-title" bundle-name="UDBundle"/>
      <id name="ems:numericValue" datatype="http://www.w3.org/2001/XMLSchema#double" value="@ KUD_DisplayPercentage ${DB00INFO.STMFP}" displayValue="@ KUD_DisplayPercentage ${DB00INFO.STMFP} display" exclude="Not_Available,Not_Collected,-1.00,-2.00,Not_Available%,Not_Collected%,-1.00%,-2.00%" axis="x" axis-type="number" axis-range="0-100"/>
      <id name="ems:unitOfMeasure rdf:resource" value="http://dbpedia.org/resource/Percentage"/>
      <id name="ems:metric rdf:resource" value="http://open-services.net/ns/perfmon#SqlStatmentFailures"/>
    </reference>
    <reference name="lock-list-inuse-metric">
      <id name="dcterms:title" value="Lock list utilization" bundle-key="locklistinusepct-title" bundle-name="UDBundle"/>
      <id name="ems:numericValue" datatype="http://www.w3.org/2001/XMLSchema#double" value="@ KUD_DisplayPercentage ${DB01INFO.LKLUP}" displayValue="@ KUD_DisplayPercentage ${DB01INFO.LKLUP} display" axis="x" axis-type="number" axis-range="0-100"/>
      <id name="ems:unitOfMeasure rdf:resource" value="http://dbpedia.org/resource/Percentage"/>
      <id name="ems:metric rdf:resource" value="http://open-services.net/ns/perfmon/#LockListUsed"/>
    </reference>
    <reference name="sort-overflow-metric">
      <id name="dcterms:title" value="Percentage of application sorts that overflowed" bundle-key="sortoverflows-metric-title" bundle-name="UDBundle"/>
      <id name="ems:numericValue" datatype="http://www.w3.org/2001/XMLSchema#double" value="@ KUD_DisplayPercentage ${DB00INFO.SOFP}" displayValue="@ KUD_DisplayPercentage ${DB00INFO.SOFP} display" axis="x" axis-type="number" axis-range="0-100"/>
      <id name="ems:unitOfMeasure rdf:resource" value="http://dbpedia.org/resource/Percentage"/>
      <id name="ems:metric rdf:resource" value="http://open-services.net/ns/perfmon#SortOverflows"/>
    </reference>
    <reference name="log-utilization-metric">
      <id name="dcterms:title" value="Percentage of log utilization" bundle-key="logutilization-metric-title" bundle-name="UDBundle"/>
      <id name="ems:numericValue" datatype="http://www.w3.org/2001/XMLSchema#double" value="@ KUD_DisplayPercentage ${KUDDBLOG.TOTLUPCT}" displayValue="@ KUD_DisplayPercentage ${KUDDBLOG.TOTLUPCT} display" axis="x" axis-type="number" axis-range="0-100"/>
      <id name="ems:unitOfMeasure rdf:resource" value="http://dbpedia.org/resource/Percentage"/>
      <id name="ems:metric rdf:resource" value="http://open-services.net/ns/perfmon#LogUsed"/>
    </reference>
  </metrics>
  <method library="kudutil.lib" name="KUD_DisplayPercentage"/>
  <method library="kudutil.lib" name="KUD_InstanceStatus"/>
</oslc_template>
